# xlslock

このアプリケーションは、指定したExcelファイル（.xlsx）に対しパスワードを設定するコマンドラインツールです。  
また、ディレクトリを指定することで配下のすべての.xlsxファイルに対して一括でパスワードを設定することができます。  
さらに、CSVファイルを指定することで、CSV内に記述されたファイルパスとパスワードの組み合わせに従って、一括でパスワードを設定できます。

## 特徴

- 対象: Excel形式（.xlsx）
- 単一ファイル、ディレクトリ、およびCSVによる一括設定が可能
- パスワードのコマンドライン指定、または対話的な入力に対応
- パスワードの二重入力による確認機能（対話入力時）

## 前提条件

- Rust環境が構築済みであること
- `cargo` コマンドが利用可能であること

## インストール方法

本リポジトリのルートディレクトリにて以下を実行してください。

```bash
cargo build --release
```

ビルド後、`target/release` ディレクトリ配下に実行ファイルが生成されます。  
（以下、実行ファイル名を`xlslock`と仮定します）

## 使い方

```bash
./xlslock <PATH> [OPTIONS]
```

### 引数

- `<PATH>`: 対象となるファイルまたはディレクトリのパス。
  - `.xlsx` ファイルを指定した場合、そのファイルに対してパスワードを設定します。
  - ディレクトリを指定した場合、そのディレクトリ配下に存在するすべての `.xlsx` ファイルに対して一括で同一のパスワードを設定します。
  - `.csv` ファイルを指定した場合、そのCSVファイルを読み込み、1行ごとに「ファイルパス,パスワード」の形式で指定されたペアに従い、一括でパスワードを設定します。

### オプション

- `-p, --password <PASSWORD>`: パスワードをコマンドライン引数として直接指定します。  
  **注:** コマンドライン上でパスワードを指定すると、履歴などに残る可能性があるため、基本的には対話的な入力を推奨します。

### パスワード入力の挙動

- `--password`オプションが指定されていない場合、標準入力からパスワードを求めます。  
  1回目の入力後、再度パスワード確認のための入力が求められ、両者が一致しない場合はエラーとなります。

### CSVファイルの形式

* CSVは各行が以下の形式であることを想定します
* 一行目はヘッダ想定のためむしされます

```
<ファイルパス>,<パスワード>
```

**例:**

```
file,path
/path/to/file1.xlsx,SecretPass1
/path/to/file2.xlsx,SecretPass2
```

この例では、`/path/to/file1.xlsx` に `SecretPass1`、`/path/to/file2.xlsx` に `SecretPass2` のパスワードを設定します。

## 実行例

1. **単一の.xlsxファイルに対してパスワードを設定（対話的入力）**:

   ```bash
   ./xlslock /path/to/yourfile.xlsx
   ```

   実行すると:
   ```
   Enter your password: 
   Confirm your password:
   ```
   のようなプロンプトが表示され、パスワードを確認後、そのファイルにパスワードを設定します。

2. **単一ファイルに対しコマンドラインオプションでパスワードを指定**:

   ```bash
   ./xlslock -p MySecretPassword /path/to/yourfile.xlsx
   ```
   
   この場合、対話的なパスワード入力は行われず、そのままファイルに `MySecretPassword` が設定されます。

3. **ディレクトリ内のすべてのxlsxファイルに対して一括設定**:

   ```bash
   ./xlslock /path/to/xlsx_directory
   ```
   
   対話的にパスワードが求められ、入力されたパスワードがディレクトリ直下およびサブディレクトリ内の全ての`.xlsx`ファイルに設定されます。

4. **CSVによる一括設定**:

   事前に`list.csv`を以下のように準備します。

   ```
   file,path
   /path/to/file1.xlsx,Password1
   /path/to/file2.xlsx,Password2
   ```
   
   実行:
   
   ```bash
   ./xlslock /path/to/list.csv
   ```
   
   これにより、`file1.xlsx` に `Password1`、`file2.xlsx` に `Password2` が設定されます。

## エラー処理

- サポートされないファイル形式を指定した場合、エラーが表示されます。
- CSV内の行形式が不正な場合、その行についてエラーが表示され処理は継続します。
- 指定したパスワードでの書き込み失敗など、何らかのI/Oエラーが発生した場合、エラーログが表示されます。

## ログ出力

デフォルトでは`info`レベル以上のログが標準出力に出力されます。

## ライセンス

本ツールは、MITライセンスの下で提供されます。詳細はLICENSEファイルを参照してください。

